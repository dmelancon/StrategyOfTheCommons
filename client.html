<html>

<head>
	<title> CloudCommuting Test </title>

	<style>

		body {
			width: 100%;
			font-family: Arial, Verdana, sans-serif;
			font-size: 100px;
			padding-top: 100px;
			background-color: hsl(0, 100%, 100%);
		}

	</style>
	<script src="/socket.io/socket.io.js"></script>
	<script>

		var myId = 1; 

		var playerIds = [1,2,3,4,5,6,7,8,9,10];
		var playerStock = [0,0,0,0,0,0,0,0,0,0];
		var playerPoints = [0,0,0,0,0,0,0,0,0,0];
		
		var stationIds = [1,2,3,4,5];
		var stationStock = [0,0,0,0,0];
		var stationBonuses = [false, false, false, false, false];

		// =============================================
		// 1 - connect to node socket.io server
		// =============================================
		var socket = io.connect('/');		

		socket.on('connect', function () {
			console.log("Connected");
		});

		// =============================================
		// 2 - Receive a check-in event from the server
		// =============================================

		socket.on('playerCheckIn', function (checkInData){

			console.log('Received CheckIn Event');

			var playerId = checkInData[0];
			var stationId = checkInData[1];

			var index = playerIds.indexOf(playerId);

			//checking in a bike
			if (myId == playerId && playerStock[index]){
				if(checkStation(stationId)){
					var r = confirm("Return Bike?");
					if (r) {
						var checkInStatus = [playerId, stationId];
					    socket.emit ('checkInConfirm', checkInStatus);
					} 
				} 
			}

			//checking out a bike
			if (myId == playerId && !playerStock[index]){
				if(checkStation(stationId)){
					var r = confirm("Take Bike?");
					if (r) {
						var checkInStatus = [playerId, stationId];
					    socket.emit ('checkInConfirm', checkInStatus);
					} 
				}
			}

		});

		function checkStation(station){
			
			var index = stationIds.indexOf(station);

			if (stationStock[index] == 5){
				alert("Station is full - find another!");
				return false;
			} else if (stationStock[index] == 0) {
				alert("Station is empty - no bikes here!");
				return false;
			}else {
				return true;
			}
		};

		socket.on('playerUpdate', function (playerData){
			//playerId playerData[0] 
			//playerPts playerData[1]
			//playerStock playerData[2]	

			for (var i = 0; playerData.length; i++){
				var index = playerIds.indexOf(playersData[i][0]);
				playerPoints[index] = playersData[i][1];
				playerStock[index] = playersData[i][2];
			}

		});

		socket.on('stationUpdate', function (stationData){
			//stationId stationData[0] number
			//stationInv stationData[1] number
			//stationBonus playerData[2] boolean
			//stationBonusPts = stationData[3] number	

			for (var i = 0; stationData.length; i++){
				var index = stationIds.indexOf(stationData[i][0]);
				stationStock[index] = stationData[i][1];
				stationStock[index] = stationData[i][2];
			}

		});	

	</script>
</head>

</html>